{% extends 'base_one_column.html' %}

{% block title %}{{ user.display_name }}{% endblock %}

{% block body %}
<div class="row">
    <div class="col-md-4">
        <div class="user-info text-center">
            <div>{{ avatar(user.avatar) }}</div>
            <h1>{{ user.display_name }}</h1>
        </div>
    </div>
    <div class="col-md-4">
        <div class="follow">
            {% if user.id != loginUser.id %}
                {% if loginUser.id not in followedIds %}
                <form action="{{ mlpath('user/account/follow') }}" method="post">
                    <input type="hidden" name="follower_id" value="{{ loginUser.id }}">
                    <input type="hidden" name="followed_id" value="{{ user.id }}">
                    <p><button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-signal"></span> Follow</button></p>
                </form>
                {% else %}
                <form action="{{ mlpath('user/account/unfollow') }}" method="post">
                    <input type="hidden" name="follower_id" value="{{ loginUser.id }}">
                    <input type="hidden" name="followed_id" value="{{ user.id }}">
                    <p><button type="submit" class="btn btn-info"><span class="glyphicon glyphicon-signal"></span> Following</button></p>
                </form>
                {% endif %}
            {% endif %}

            <p>{{ followeds|length }} người theo dõi {{ user.display_name }}</p>
            {% if followeds|length %}
            <ul class="list-inline">
                {% for follow in followeds %}
                <li><a href="{{ mlpath('user/'~follow.username) }}">
                    {{ avatar(follow.avatar, 30, 'class="img-circle" title="'~follow.display_name~'"') }}</a></li>
                {% endfor %}
            </ul>
            {% endif %}

            <p>{{ followers|length }} người được {{ user.display_name }} theo dõi</p>
            {% if followers|length %}
            <ul class="list-inline">
                {% for follow in followers %}
                <li><a href="{{ mlpath('user/'~follow.username) }}">
                    {{ avatar(follow.avatar, 30, 'class="img-circle" title="'~follow.display_name~'"') }}</a></li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>
    <div class="col-md-4"></div>
</div>
<div class="row">
    <div class="feed col-md-10 col-md-offset-1">
        {% for post in posts %}
        <div class="item row">
            <div class="col-md-10">
                <div class="item-header">
                    <a href="{{ path('post/'~post.alias) }}">{{ post.title }}</a>
                    <div class="tag">
                        {% for tag in post.tags %}
                        {% set tagUrl = path('cms/tag/'~tag.alias~'/view') %}
                        <a href="{{ tagUrl }}" class="label label-default {{ tag.color }}">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                </div>
                <div class="item-content">
                    {{ post.content|striptags|slice(0, 180) ~ '...' }}
                </div>
                <div class="item-meta small">
                    <a href="{{ path('user/'~post.username~'/profile') }}">
                        {{ post.display_name }}</a> written {{ post.created_at|time_ago }}
                </div>
            </div>
            <div class="col-md-2">
                <a href="{{ path('post/'~post.alias) }}">
                    <!--13 <span class="glyphicon glyphicon-thumbs-up"></span>-->
                    {{ post.comment_count }} <span class="glyphicon glyphicon-comment"></span>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% include 'Section/pagination.html' with {'paginator': paginator} %}
{% endblock %}